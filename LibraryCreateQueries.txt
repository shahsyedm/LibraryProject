-- Create Table Queries
CREATE TABLE Books(ISBN CHAR(13) PRIMARY KEY,  Title VARCHAR(200), Subject VARCHAR(50), DatePublished DATE);
CREATE TABLE Authors(AuthorID CHAR(9) PRIMARY KEY, FirstName VARCHAR(100), LastName VARCHAR(100), DOB Date);
CREATE TABLE Patrons(
	Email VARCHAR(100) PRIMARY KEY,
	Password VARCHAR(100),  
	FirstName VARCHAR(100), 
	LastName VARCHAR(100), 
	DOB DATE,
	IsAdmin CHAR(1)
);
CREATE TABLE Inventory(
	ISBN CHAR(13) PRIMARY KEY NOT NULL,
	Quantity INTEGER DEFAULT 1,
	CONSTRAINT book_fk FOREIGN KEY(ISBN) REFERENCES Books(ISBN)
);

------------------- Relationship Tables -------------------------

CREATE TABLE WrittenBy(
	AuthorID CHAR(9) REFERENCES Authors NOT NULL,
	ISBN CHAR(13)    REFERENCES Books, 
	CONSTRAINT wb_pk PRIMARY KEY(AuthorID, ISBN)
);

CREATE TABLE Borrow(
	ISBN CHAR(13) 	 REFERENCES Books,
	Email VARCHAR(100)  REFERENCES Patrons,
	BorrowDate DATE,
	DueDate DATE,
	CONSTRAINT bw_pk PRIMARY KEY(Email, ISBN)
);

------------------- Copy into Table Queries -------------------------

\copy Books(ISBN, Title, Subject, DatePublished) FROM '/Users/syeda/Desktop/COP4710FinalProject/Books.csv' WITH DELIMITER ',' CSV HEADER;
\copy Authors(AuthorID, FirstName, LastName, DOB) FROM '/Users/syeda/Desktop/COP4710FinalProject/Authors.csv' WITH DELIMITER ',' CSV HEADER;
\copy WrittenBy(AuthorID, ISBN) FROM '/Users/syeda/Desktop/COP4710FinalProject/WrittenBy.csv' WITH DELIMITER ',' CSV HEADER;

------------------- Creating Users and Privileges -------------------------
CREATE USER librarian with encrypted password 'password';
GRANT CONNECT ON DATABASE bookstore TO librarian;
GRANT SELECT,INSERT,UPDATE,DELETE ON ALL TABLES IN SCHEMA public TO librarian;

CREATE USER patron with encrypted password 'password';
GRANT CONNECT ON DATABASE bookstore TO patron;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO patron;

